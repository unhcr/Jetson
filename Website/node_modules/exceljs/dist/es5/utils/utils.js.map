{"version":3,"sources":["../../../lib/utils/utils.js"],"names":["fs","require","PromishLib","inherits","cls","superCtor","statics","prototype","super_","Object","keys","forEach","defineProperty","i","getOwnPropertyDescriptor","properties","constructor","value","enumerable","writable","configurable","create","utils","module","exports","nop","promiseImmediate","Promish","resolve","global","setImmediate","setTimeout","dateToExcel","d","date1904","getTime","excelToDate","v","millisecondSinceEpoch","Math","round","Date","parsePath","filepath","last","lastIndexOf","path","substring","name","getRelsPath","xmlEncode","text","replace","c","xmlDecode","validInt","parseInt","isNaN","isDateFmt","fmt","result","match","exists","toIsoDateString","dt","toIsoString","subsstr"],"mappings":"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","file":"utils.js","sourcesContent":["/**\r\n * Copyright (c) 2014-2017 Guyon Roche\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar fs = require('fs');\r\nvar PromishLib = require('./promish');\r\n\r\n// useful stuff\r\nvar inherits = function(cls, superCtor, statics, prototype) {\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  cls.super_ = superCtor;\r\n\r\n  if (!prototype) {\r\n    prototype = statics;\r\n    statics = null;\r\n  }\r\n\r\n  if (statics) {\r\n    Object.keys(statics).forEach(i => {\r\n      Object.defineProperty(cls, i, Object.getOwnPropertyDescriptor(statics, i));\r\n    });\r\n  }\r\n\r\n  var properties = {\r\n    constructor: {\r\n      value: cls,\r\n      enumerable: false,\r\n      writable: false,\r\n      configurable: true\r\n    }\r\n  };\r\n  if (prototype) {\r\n    Object.keys(prototype).forEach(i => {\r\n      properties[i] = Object.getOwnPropertyDescriptor(prototype, i);\r\n    });\r\n  }\r\n\r\n  cls.prototype = Object.create(superCtor.prototype, properties);\r\n};\r\n\r\n\r\nvar utils = module.exports = {\r\n  nop: function() {},\r\n  promiseImmediate: function(value) {\r\n    return new PromishLib.Promish(function(resolve) {\r\n      if (global.setImmediate) {\r\n        setImmediate(function() {\r\n          resolve(value);\r\n        });\r\n      } else {\r\n        // poorman's setImmediate - must wait at least 1ms\r\n        setTimeout(function() {\r\n          resolve(value);\r\n        }, 1);\r\n      }\r\n    });\r\n  },\r\n  inherits: inherits,\r\n  dateToExcel: function(d, date1904) {\r\n    return 25569 + (d.getTime() / (24 * 3600 * 1000)) - (date1904 ? 1462 : 0);\r\n  },\r\n  excelToDate: function(v, date1904) {\r\n    var millisecondSinceEpoch = Math.round((v - 25569 + (date1904 ? 1462 : 0)) * 24 * 3600 * 1000);\r\n    return new Date(millisecondSinceEpoch);\r\n  },\r\n  parsePath: function(filepath) {\r\n    var last = filepath.lastIndexOf('/');\r\n    return {\r\n      path: filepath.substring(0, last),\r\n      name: filepath.substring(last + 1)\r\n    };\r\n  },\r\n  getRelsPath: function(filepath) {\r\n    var path = utils.parsePath(filepath);\r\n    return path.path + '/_rels/' + path.name + '.rels';\r\n  },\r\n  xmlEncode: function(text) {\r\n    // eslint-disable-next-line no-control-regex\r\n    return text.replace(/[<>&'\"\\x7F\\x00-\\x08\\x0B-\\x0C\\x0E-\\x1F]/g, function(c) {\r\n      switch (c) {\r\n        case '<': return '&lt;';\r\n        case '>': return '&gt;';\r\n        case '&': return '&amp;';\r\n        case '\\'': return '&apos;';\r\n        case '\"': return '&quot;';\r\n        default: return '';\r\n      }\r\n    });\r\n  },\r\n  xmlDecode: function(text) {\r\n    return text.replace(/&([a-z]*);/, function(c) {\r\n      switch (c) {\r\n        case '&lt;': return '<';\r\n        case '&gt;': return '>';\r\n        case '&amp;': return '&';\r\n        case '&apos;': return '\\'';\r\n        case '&quot;': return '\"';\r\n        default: return c;\r\n      }\r\n    });\r\n  },\r\n  validInt: function(value) {\r\n    var i = parseInt(value, 10);\r\n    return !isNaN(i) ? i : 0;\r\n  },\r\n\r\n  isDateFmt: function(fmt) {\r\n    if (!fmt) { return false; }\r\n\r\n    // must remove all chars inside quotes and []\r\n    fmt = fmt.replace(/\\[[^\\]]*]/g, '');\r\n    fmt = fmt.replace(/\"[^\"]*\"/g, '');\r\n    // then check for date formatting chars\r\n    var result = fmt.match(/[ymdhMsb]+/) !== null;\r\n    return result;\r\n  },\r\n\r\n  fs: {\r\n    exists: function(path) {\r\n      return new PromishLib.Promish(function(resolve) {\r\n        fs.exists(path, function(exists) {\r\n          resolve(exists);\r\n        });\r\n      });\r\n    }\r\n  },\r\n  \r\n  toIsoDateString: function(dt) {\r\n    return dt.toIsoString().subsstr(0, 10);\r\n  }\r\n};\r\n\r\n"]}